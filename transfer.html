<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trasferimento Dati - Generatore Numeri Casuali</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .container {
            text-align: center;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 500px;
            width: 90%;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        h1 {
            margin-bottom: 1rem;
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        p {
            margin-bottom: 1rem;
            opacity: 0.9;
            line-height: 1.5;
        }
        
        .status {
            font-size: 0.9rem;
            opacity: 0.8;
            font-style: italic;
        }
        
        .error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #fef2f2;
        }
        
        .success {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            color: #f0fdf4;
        }
        
        .manual-redirect {
            margin-top: 2rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .manual-redirect a {
            color: #60a5fa;
            text-decoration: none;
            font-weight: 500;
        }
        
        .manual-redirect a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container" id="container">
        <div class="spinner" id="spinner"></div>
        <h1 id="title">Trasferimento Dati in Corso</h1>
        <p id="message">Stiamo rilevando i tuoi dati salvati...</p>
        <div class="status" id="status">Inizializzazione...</div>
    </div>

    <script>
        const NEW_GENERATOR_URL = 'https://exelvi.xyz/generatore';
        const DELAY_BEFORE_REDIRECT = 2000; // 2s

        const container = document.getElementById('container');
        const spinner = document.getElementById('spinner');
        const title = document.getElementById('title');
        const message = document.getElementById('message');
        const status = document.getElementById('status');

        function updateStatus(text) {
            status.textContent = text;
        }

        function showError(errorMessage) {
            container.className = 'container error';
            spinner.style.display = 'none';
            title.textContent = 'Errore nel Trasferimento';
            message.textContent = errorMessage;
            status.textContent = 'Si è verificato un errore.';
            
            setTimeout(() => {
                container.innerHTML += `
                    <div class="manual-redirect">
                        <p>Puoi comunque accedere al nuovo generatore:</p>
                        <a href="${NEW_GENERATOR_URL}" target="_self">Vai al Nuovo Generatore</a>
                    </div>
                `;
            }, 1000);
        }

        function showSuccess(dataFound) {
            container.className = 'container success';
            spinner.style.display = 'none';
            title.textContent = dataFound ? 'Dati Trovati!' : 'Trasferimento Completato';
            message.textContent = dataFound 
                ? 'I tuoi dati sono stati trovati e verranno trasferiti al nuovo generatore.'
                : 'Nessun dato precedente trovato. Verrai reindirizzato al nuovo generatore.';
            status.textContent = 'Reindirizzamento in corso...';
        }

        function transferData() {
            try {
                updateStatus('Ricerca dati salvati...');

                const numeriEsclusiNew = localStorage.getItem('numeriEsclusiNew');
                const settingsNew = localStorage.getItem('settingsNew');
                const selectedSave = localStorage.getItem('selectedSave');

                const hasData = numeriEsclusiNew || settingsNew || selectedSave;

                if (hasData) {
                    updateStatus('Dati trovati, preparazione trasferimento...');

                    const transferData = {};
                    
                    if (numeriEsclusiNew) {
                        try {
                            transferData.numeriEsclusiNew = JSON.parse(numeriEsclusiNew);
                        } catch (e) {
                            console.warn('Errore nel parsing di numeriEsclusiNew:', e);
                        }
                    }
                    
                    if (settingsNew) {
                        try {
                            transferData.settingsNew = JSON.parse(settingsNew);
                        } catch (e) {
                            console.warn('Errore nel parsing di settingsNew:', e);
                        }
                    }
                    
                    if (selectedSave) {
                        transferData.selectedSave = selectedSave;
                    }

                    updateStatus('Codifica dati per il trasferimento...');

                    const encodedData = btoa(JSON.stringify(transferData));

                    showSuccess(true);

                    const targetUrl = `${NEW_GENERATOR_URL}?data-transfer=true&data-found=true&data=${encodeURIComponent(encodedData)}`;

                    setTimeout(() => {
                        window.location.href = targetUrl;
                    }, DELAY_BEFORE_REDIRECT);

                } else {
                    updateStatus('Nessun dato trovato...');
                    showSuccess(false);

                    const targetUrl = `${NEW_GENERATOR_URL}?data-transfer=true&data-found=false`;
                    
                    setTimeout(() => {
                        window.location.href = targetUrl;
                    }, DELAY_BEFORE_REDIRECT);
                }

            } catch (error) {
                console.error('Errore durante il trasferimento:', error);
                showError('Si è verificato un errore imprevisto durante il trasferimento dei dati.');
            }
        }

        // Avvia il processo di trasferimento
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(transferData, 1000);
        });

        window.addEventListener('error', (event) => {
            console.error('Errore JavaScript:', event.error);
            showError('Si è verificato un errore tecnico. Riprova più tardi.');
        });

        window.addEventListener('unhandledrejection', (event) => {
            console.error('Promise rejection:', event.reason);
            showError('Si è verificato un errore di connessione. Controlla la tua connessione internet.');
        });
    </script>
</body>
</html>
